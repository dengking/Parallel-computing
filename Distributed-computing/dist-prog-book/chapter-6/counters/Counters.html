<!DOCTYPE html>
<!-- saved from url=(0049)http://dist-prog-book.com/chapter/6/counters.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Counters</title>
  <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

  <!-- jquery js -->
  <script src="./Counters_files/jquery-1.11.0.min.js.下载" type="text/javascript"></script>

  <!-- retina js -->
  <script src="./Counters_files/retina.js.下载" type="text/javascript"></script>

  <!-- Bootstrap JS and CSS -->
  <!-- <link rel="stylesheet" href="/resources/css/bootstrap.min.css" type="text/css" media="screen, print"/> -->
  <link rel="stylesheet" href="./Counters_files/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.3.0/dist/bootstrap-toc.min.css">
  <script src="./Counters_files/bootstrap.min.js.下载" type="text/javascript"></script>
  <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.3.0/dist/bootstrap-toc.min.js"></script>

  <link rel="stylesheet" href="./Counters_files/fira.css">
  <link href="./Counters_files/css" rel="stylesheet">
  <link href="./Counters_files/css(1)" rel="stylesheet">

  <!-- Fonts -->
  <link href="./Counters_files/css(2)" rel="stylesheet">
  <link href="./Counters_files/css(3)" rel="stylesheet" type="text/css">
  <link href="./Counters_files/css(4)" rel="stylesheet" type="text/css">

  <!-- MathJax -->
  <script src="./Counters_files/MathJax.js.下载" id=""></script>

  <!-- <link rel="stylesheet" href="/resources/css/tufte.css"/> -->
  <!-- <link rel="stylesheet" href="/resources/css/custom.css"/> -->
  <!-- <link rel="stylesheet" href="/resources/css/github.css"/> -->

  <link rel="stylesheet" href="./Counters_files/latex.css">
  <link rel="stylesheet" href="./Counters_files/entypo.css" type="text/css">
  <link rel="stylesheet" href="./Counters_files/prettify.css" type="text/css">
  <!-- <link rel="stylesheet" href="/resources/css/main.css" type="text/css" /> -->
  <link rel="stylesheet" href="./Counters_files/blog.css" type="text/css">

  <!-- Custom javascript -->
  <script src="./Counters_files/main.js.下载" type="text/javascript"></script>

  <!-- <link rel="canonical" href="http://yourdomain.com/chapter/6/counters.html"> -->
  <link rel="alternate" type="application/rss+xml" title="Programming Models for Distributed Computing" href="http://yourdomain.com/feed.xml">
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>

<body data-spy="scroll" data-target="#toc"><div id="MathJax_Message" style="display: none;"></div>
  <div class="topbar">
    <div class="container">
      <div class="row">
        <div class="col-sm-1"></div>
        <div class="col-sm-5">
          <div class="logo-wrap">
            <a href="http://dist-prog-book.com/">
              <svg class="logo" width="100" height="100">
                <circle cx="50" cy="50" r="35" stroke-width="6" stroke="#fff" fill="#b3c7cf"></circle>
                <circle cx="50" cy="50" r="20" fill="#92adb9"></circle>
                <circle cx="50" cy="50" r="14" fill="#7499AA"></circle>
              </svg>
              <div class="book-title">
                <div class="prog-mod">Programming Models for</div>
                <div class="dist-comp">Distributed Computing</div>
              </div>
            </a>
          </div>
        </div>
        <div class="col-sm-5 visible-md visible-lg">
          <div class="navbar-wrap">
            <ul class="navbar">
              <li><a href="http://dist-prog-book.com/index.html">Intro</a></li>
<li><a href="http://dist-prog-book.com/chapter">Chapters</a></li>
<li><a href="http://dist-prog-book.com/about.html">About</a></li>
            </ul>
          </div>
        </div>
        <div class="col-sm-5 visible-sm visible-xs">
          <div id="burger" data-toggle="collapse" data-target="#navbar-responsive-wrap">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div class="navbar-responsive-wrap navbar-static-top navbar-collapse collapse" id="navbar-responsive-wrap">
            <ul class="navbar-responsive">
              <li><a href="http://dist-prog-book.com/index.html">Intro</a></li>
<li><a href="http://dist-prog-book.com/chapter">Chapters</a></li>
<li><a href="http://dist-prog-book.com/about.html">About</a></li>
            </ul>
          </div>
        </div>
        <div class="col-sm-1">
        </div>
      </div>
    </div>
  </div>

  <div class="container blog">
    <div class="row">
      <div class="col-sm-2"></div>
      <div class="col-sm-6">
        
        <div class="category"></div>
        <h1 class="page-title">Counters</h1>
        <div class="author">By Aviral Goel</div>
        <div class="subtitle">
          
            <span class="minutes">(16 min read)</span>
          
        </div>
        <div class="dash">—</div>
        <!-- <article> -->

  <!-- <h1 class="post-title">Counters</h1> -->
  <!-- <div class="author">By Aviral Goel</div> -->

    <p>Counters are replicated integers. They are the most basic distributed object. This chapter describes the different variations of counter CRDT in both state based and operation based form.</p>

<h2 id="g-counter---increment-only-counter">G-counter - Increment only counter</h2>

<p>As the name suggests, these counters only support increment operation. They can be used to implement the <code class="highlighter-rouge">like</code> button functionality of social media websites.</p>

<h3 id="cmrdt-operation-based-design">CmRDT: Operation based design</h3>

<p>In the operation based implementation, the increment operation is transmitted to all other replicas. 
This is straightforward to implement as there is only one update operation.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code class="prettyprint lang-"><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="n">CmRDT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span><span class="s">"increment"</span><span class="p">,</span> <span class="n">replica</span><span class="p">)</span>
</code></pre>
</div>

<p>Let’s try to understand how it works through an example. The figure below shows an execution trace of three replicas confirming to this specification. In accordance with the specification, each increment request increments the counter locally by one unit and the operation is transmitted by the replica to all other replicas of the system.</p>

<figure class="fullwidth">
    <img style="margin: auto; display: block;" src="./Counters_files/operation-based-increment-only-counter.png" alt="Operation based increment only counter">
</figure>

<p>We can make the following observations:</p>

<ul>
  <li>
    <p><strong>Eventually consistent</strong> - At <em>t<sub>16</sub></em>, the replicas are inconsistent. Eventually, they all attain consistency. This is because the increment operation happens immediately at one replica but takes time to be transmitted over the network to other replicas. Within this duration, the replicas may be inconsistent.</p>
  </li>
  <li>
    <p><strong>Reliable broadcast</strong> - The increment operation has to be transmitted to all replicas. If the network fails to deliver the operation, the system will never be able to achieve consistency. For example - if the increment operation on <strong>c<sub>2</sub></strong> at <em>t<sub>11</sub></em> is not transmitted reliably to <strong>c<sub>1</sub></strong>, then its value will always be one unit less than the correct value.</p>
  </li>
  <li>
    <p><strong>Concurrent operations</strong> - A replica may have to handle concurrent operations. For example, at <em>t<sub>19</sub></em>, <b>c<sub>1</sub></b> encounters two increment operations. Since its the same operation, there is only one way to handle the situation. There is no conflict.</p>
  </li>
</ul>

<h3 id="cvrdt-state-based-design">CvRDT: State based design</h3>

<p>In the state based implementation, the counter state is transmitted to all other replicas.
But how do we model the state? Of course, the counter’s count is its state. 
Since the count always increases, modeling the state as count automatically makes it a join semilattice.</p>

<p>The code below provides the specification of this counter.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code class="prettyprint lang-"><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="n">CvRDT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="n">count</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>       
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>         
        <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">()))</span>
</code></pre>
</div>

<p>Let’s try to understand how it works through an example. The figure below shows an execution trace of three replicas confirming to this specification. The replicas keep transmitting their state at random times to other randomly chosen replicas.</p>

<figure class="fullwidth">
    <img src="./Counters_files/state-based-increment-only-counter-incorrect.png" alt="State based increment only counter (incorrect)">
</figure>

<p>We can make the following observations:</p>

<ul>
  <li>
    <p><strong>Eventual convergence</strong> - At <em>t<sub>26</sub></em>, the replicas are inconsistent. Eventually, they all converge. This is because the replicas transmit state at random times to randomly chosen replicas. Until their states are merged, the replicas may be inconsistent.</p>
  </li>
  <li>
    <p><strong>Correctness</strong> - The clients issue a total of four increment requests. But the eventually consistent value of replicas is 4. So, the design is <strong>incorrect</strong>.</p>
  </li>
  <li>
    <p><strong>Concurrent operations</strong> - A replica may have to handle concurrent operations. For example, at <em>t<sub>28</sub></em>, <b>c<sub>1</sub></b> receives states of the other two replicas. Since the merge operation is commutative, the order in which these operations are handled does not matter.</p>
  </li>
  <li>
    <p><strong>Unreliable broadcast</strong> - Messages may be lost during transmission. Message sent by <b>c<sub>2</sub></b> at <em>t<sub>9</sub></em> is lost. But eventually, some messages from <b>c<sub>2</sub></b> reach other replicas. As long as messages eventually reach other replicas, directly or indirectly, the system will achieve consistency. A message can also be received out of order or duplicated.</p>
  </li>
</ul>

<p>Let’s figure out why our design is incorrect. We notice that the merge operation simply compares the state of the replicas and returns the bigger of the two counts. What we really need is to add the two counts as we need the total counts issued by all clients across all replicas. But this poses another problem. The merge operation is no longer idempotent, i.e. - repeated merging of same values will not return the same result. This means that if a message gets duplicated, then we will get incorrect count. What’s more is that the merge operation will no longer compute the <strong>least</strong> upper bound. It will compute an upper bound but that will not be the least upper bound. This clearly violates the mathematical model we set out to implement. So we can’t modify our merge method. This means that we need to change our representation of the state.
Let’s observe the problem again. Our merge method only returns the state of that replica which handled the maximum number of counts. It loses counts of other replicas. Let’s represent the state as a sequence of counts. Each value in the sequence corresponds to the count of a replica. So we have as many values in a state as the number of replicas. We also design the merge operation to compute the index-wise maximum of the state.</p>

<p>The specification below shows how this can be implemented.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code class="prettyprint lang-"><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="n">CvRDT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">counts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="n">counts</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_counts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c"># return a copy of the counts</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_counts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">replicaId</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;=</span> <span class="n">v2</span> <span class="k">for</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span>
                   <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">(),</span>
                       <span class="n">other</span><span class="o">.</span><span class="n">counts</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">(),</span>
                                    <span class="n">other</span><span class="o">.</span><span class="n">counts</span><span class="p">())))</span>
</code></pre>
</div>

<p>The figure below shows an execution trace of three replicas confirming to this specification.</p>

<figure class="fullwidth">
    <img src="./Counters_files/state-based-increment-only-counter-correct.png" alt="State based increment only counter (correct) lattice">
</figure>

<p>This design converges to the correct value. This provides us an eventually consistent state based increment only counter.</p>

<h2 id="pn-counter---increment-and-decrement-counter">PN-counter - Increment and Decrement counter</h2>

<p>A PN-counter can be incremented and decremented. These can serve as a general purpose counters, as they also provide a decrement operation. For example - counting the number of users active one a social media website at any point. Note that the users can go offline and the counter will have to decremented. This can’t be done with an increment only counter.</p>

<h3 id="cmrdt-operation-based-design-1">CmRDT: Operation based design</h3>

<p>The code below provides the specification of an operation based increment and decrement counter.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code class="prettyprint lang-"><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="n">CmRDT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span><span class="s">"increment"</span><span class="p">,</span> <span class="n">replica</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decrement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span><span class="s">"decrement"</span><span class="p">,</span> <span class="n">replica</span><span class="p">)</span>
</code></pre>
</div>

<p>Let’s try to understand how it works through an example. The figure below shows an execution trace of three replicas confirming to this specification. In accordance with the specification, each increment request increments the counter locally by one unit and each decrement request decrements the counter locally by one unit. The corresponding operation is transmitted by the replica to all other replicas of the system.</p>

<figure class="fullwidth">
    <img style="margin: auto; display: block;" src="./Counters_files/operation-based-increment-and-decrement-counter.png" alt="Operation based increment and decrement counter">
</figure>

<p>We can make the the following observations:</p>

<ul>
  <li>
    <p><strong>Eventual Consistency</strong> - At <em>t<sub>26</sub></em>, the replicas are inconsistent. Eventually, they all achieve consistency. This is because the operations happen immediately at one replica but take time to be transmitted over the network to other replicas. Within this duration, the replicas may be inconsistent.</p>
  </li>
  <li>
    <p><strong>Reliable broadcast</strong> - Each operation has to be transmitted to all replicas. If the network fails to deliver an operation, the system will never be able to achieve consistency. For example - if the decrement operation on <strong>c<sub>2</sub></strong> at <em>t<sub>6</sub></em> is not transmitted reliably to <strong>c<sub>1</sub></strong>, then its value will always be one unit more than the correct value.</p>
  </li>
  <li>
    <p><strong>Concurrent operations</strong> - A replica may have to handle concurrent operations. For example, at <em>t<sub>30</sub></em>, <b>c<sub>1</sub></b> and <b>c<sub>2</sub></b> encounter increment and decrement operations concurrently. Let’s take a look at the two choices:</p>
  </li>
</ul>

<figure class="fullwidth">
    <img style="margin: auto; display: block;" src="./Counters_files/increment-and-decrement-operations-commute.png" alt="Increment and decrement operations commute">
</figure>

<p>In both cases the result is same because the two operations commute, i.e. - the order in which they are executed by the replicas does not matter. Both replicas perform them in different orders and still achieve consistency, eventually.</p>

<h3 id="cvrdt-state-based-design-1">CvRDT: State based design</h3>

<p>The code below provides the specification of a state based increment and decrement counter. We take inspiration from the design of state based increment only counter and model the state of this counter in the same way.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code class="prettyprint lang-"><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="n">CvRDT</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">counts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replicas</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span> <span class="o">=</span> <span class="n">counts</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_counts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c"># return a copy of the counts</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_counts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">replicaId</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decrement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counts</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">replicaId</span><span class="p">()]</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;=</span> <span class="n">v2</span> <span class="k">for</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span>
                   <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">(),</span>
                       <span class="n">other</span><span class="o">.</span><span class="n">counts</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">(),</span>
                                    <span class="n">other</span><span class="o">.</span><span class="n">counts</span><span class="p">())))</span>
</code></pre>
</div>

<p>Let’s try to understand how it works through an example. The figure below shows an execution trace of three replicas confirming to this specification. The replicas keep transmitting their state at random times to other randomly chosen replicas.</p>

<figure class="fullwidth">
    <img src="./Counters_files/state-based-increment-and-decrement-counter-incorrect.png" alt="State based increment and decrement counter (incorrect)">
</figure>

<p>We can make the the following observations:</p>

<ul>
  <li>
    <p><strong>Eventual convergence</strong> - At <em>t<sub>26</sub></em>, the replicas are inconsistent. Eventually, they all converge. This is because the replicas transmit state at random times to randomly chosen replicas. Until their states are merged, the replicas may be inconsistent.</p>
  </li>
  <li>
    <p><strong>Correctness</strong> - The clients issue a total of four increment requests and 2 decrement requests. But the eventually consistent value of replicas is 4. So, the design is <strong>incorrect</strong>.</p>
  </li>
  <li>
    <p><strong>Concurrent operations</strong> - A replica may have to handle concurrent operations. For example, at <em>t<sub>27</sub></em> <b>c<sub>1</sub></b> has to handle 2 merge operations concurrently. Since the state forms a partially ordered set and the merge operation computes its least upper bound, the order in which the merge operation happens does not affect the final outcome. Similarly, at <em>t<sub>21</sub></em> and <em>t<sub>29</sub></em>, two operations arrive concurrently at <b>c<sub>3</sub></b> and <b>c<sub>2</sub></b> respectively.</p>
  </li>
  <li>
    <p><strong>Unreliable broadcast</strong> - Messages may be lost during transmission. Message sent by <b>c<sub>3</sub></b> at <em>t<sub>12</sub></em> is lost. But eventually, message at <em>t<sub>25</sub></em> reaches another replica. As long as messages eventually reach other replicas, directly or indirectly, the system will achieve consistency. A message can also be received out of order or duplicated.</p>
  </li>
</ul>

<p>Though we modeled the state after the increment only state based counter, this design doesn’t work. Let’s try to figure out what went wrong. At <em>t<sub>12</sub></em>, <b>c<sub>1</sub></b> merges the state from <b>c<sub>2</sub></b>. The merge operation computes the index wise maximum in accordance with the specification. In doing so, the <em>-1</em> value of <em>c<sub>2</sub></em> due to the decrement operation at <em>t<sub>6</sub></em> is lost. 
To make matters clearer, let’s look at a section of the lattice formed by the state of this counter -</p>

<figure class="fullwidth">
    <img src="./Counters_files/state-based-increment-and-decrement-counter-incorrect-lattice.png" alt="State based increment and decrement counter(incorrect) lattice">
</figure>

<p>Its clear that we have violated the basic constraint, the decrement operation does not take the state higher up in the lattice. In other words, the decrement operation is non monotonic. So, when the results of increment and decrement operations are merged together, then the result of the increment operation is returned, as it is always higher up in the lattice. So the replicas only count the total number of increments.</p>

<p>But we do gain two valuable insights from this design-</p>

<blockquote>
  <p>Eventual convergence does not guarantee correctness.</p>
</blockquote>

<blockquote>
  <p>Incorrect designs may still converge eventually.</p>
</blockquote>

<p>Let’s try to correct this problem. We need a way to count the decrement operations without losing monotonicity. One solution is to model this counter using two increment only counters. The first counter counts the increment operations and the second one counts the decrement operations. The value of the actual counter is the difference between the two corresponding counters. The specification below shows how this can be implemented.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code class="prettyprint lang-"><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="n">CvRDT</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">increments</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">decrements</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">increments</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_increments</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span><span class="p">(</span><span class="n">replicas</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_increments</span> <span class="o">=</span> <span class="n">increments</span>
        <span class="k">if</span> <span class="n">decrements</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_decrements</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span><span class="p">(</span><span class="n">replicas</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_decrements</span> <span class="o">=</span> <span class="n">decrements</span>

    <span class="k">def</span> <span class="nf">increments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c"># return a copy of the increments</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_increments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decrements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="c"># return a copy of the decrements</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_decrements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">increments</span><span class="p">())</span> <span class="o">-</span>
                <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decrements</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_increments</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">replicaId</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decrement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decrements</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">replicaId</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;=</span> <span class="n">v2</span> <span class="k">for</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">increments</span><span class="p">(),</span>
                        <span class="n">other</span><span class="o">.</span><span class="n">increments</span><span class="p">()))</span>
                <span class="ow">and</span>
                <span class="nb">all</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;=</span> <span class="n">v2</span> <span class="k">for</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="ow">in</span>
                    <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decrements</span><span class="p">(),</span>
                        <span class="n">other</span><span class="o">.</span><span class="n">decrements</span><span class="p">())))</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span>
			<span class="n">increments</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">increments</span><span class="p">(),</span>
                                      <span class="n">other</span><span class="o">.</span><span class="n">increments</span><span class="p">())),</span>
            <span class="n">decrements</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decrements</span><span class="p">(),</span>
                                      <span class="n">other</span><span class="o">.</span><span class="n">decrements</span><span class="p">())))</span>
</code></pre>
</div>

<p>The figure below shows an execution trace of three replicas confirming to this specification.</p>

<figure class="fullwidth">
    <img src="./Counters_files/state-based-increment-and-decrement-counter-correct.png" alt="State based increment and decrement counter (correct)">
</figure>

<p>This design converges to the correct value. This provides us an eventually consistent state based increment and decrement counter. We can take a look at the lattice formed by the state to convince ourselves.</p>

<figure class="fullwidth">
    <img src="./Counters_files/state-based-increment-and-decrement-counter-correct-lattice.png" alt="State based increment and decrement counter(correct) lattice">
</figure>

<h2 id="references">References</h2>

<ol class="bibliography"><li><span id="Shapiro2011">Shapiro, M., Preguiça, N., Baquero, C., &amp; Zawirski, M. (2011). A comprehensive study of Convergent and Commutative Replicated Data Types. In <i>[Research Report] RR-7506, Inria – Centre Paris-Rocquencourt</i> (p. 50).</span></li>
<li><span id="CRDT2011">Marc Shapiro, C. B., Nuno Preguiça, &amp; Zawirski, M. (2011). Conflict-free Replicated Data Types. In <i>[Research Report] RR-7687, INRIA</i> (p. 18).</span></li></ol>



<!-- </article> -->

      </div>
      <div class="col-sm-3">
        <nav id="toc" class="hidden-print hidden-xs affix" data-spy="affix" data-toggle="toc"><div class="toc-header affix" data-spy="affix"><span class="toc-contents">Contents</span></div><span class="toc-hide">Hide</span><span class="toc-expand">Expand</span></nav>
      </div>
      <div class="col-sm-1"></div>
    </div>
    <div class="row">
      <div class="col-sm-2"></div>
      <div class="col-sm-6">
        <div class="footer-links">
          
          
          
        </div>
      </div>
      <div class="col-sm-4"></div>
    </div>
  </div>

  <script>

      $( ".toc-hide" ).click(function() {
        // $( this ).toggleClass( "gray-bg" );
        $(".toc-contents").toggleClass( "lighter" );

        if ($(this).text() == 'Hide') {
          $(this).text("Show");
        } else {
          $(this).text("Hide");
        }
        // toggle visibility of contents, and expand button
        $(".nav").toggle();
        $(".toc-expand").toggle();
      });

      $( ".toc-expand" ).click(function() {
        // $( this ).toggleClass( "gray-bg" );

        if ($(this).text() == 'Expand') {
          $(this).text("Compact");
          $(".nav").css('display', 'block');
        } else {
          $(this).text("Expand");
          $(".nav .nav").css('display', 'none');
        }
      });

      // get current year and put it in span
      var currYear = new Date().getFullYear()
      $(".current-year").text(currYear);
  </script>




</body></html>